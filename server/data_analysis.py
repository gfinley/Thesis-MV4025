import os
import csv
from matplotlib import pyplot as plt
import numpy as np
import numpy
from scipy.interpolate import interp1d
from scipy.interpolate import make_interp_spline
from matplotlib.pyplot import figure
import pandas


#do a os walk for all the files in the directory
directory = "../../ray_results"

root, dirs, files = next(os.walk(directory))

#make an array of all the files in experiment 1

#print all dirs
for folder in dirs:
    if "08-24" in folder:
            print(folder)
            #print all files in the folder
            
            
Experiment1 = ["PPO_atlatl_2022-11-17_08-08-27_sb_nred","PPO_atlatl_2022-11-17_08-08-27llg1m31x","PPO_atlatl_2022-11-17_08-08-2601h1uuoe"]
Experiment1_labels = ["FC Net","standard CNN","Hexagly CNN"]

Experiment2 = ["PPO_atlatl_2022-11-17_08-09-44nuq3q05z","PPO_atlatl_2022-11-17_08-09-44s01mwzok","PPO_atlatl_2022-11-17_08-09-45a2hocnwh","PPO_atlatl_2022-11-17_08-09-45cixi4ngr"]
Experiment2_labels = ["20 workers, 2 CPU per, 8 CPU head","15 workers, 2 CPU per, 8 CPU head","10 workers, 2 CPU per, 8 CPU head","5 workers, 2 CPU per, 8 CPU head"]

Experiment3 = ["PPO_atlatl_2022-11-17_08-24-08yze5mi1c","PPO_atlatl_2022-11-17_08-24-11p1fb00li","PPO_atlatl_2022-11-17_08-24-13naqrxa_2","PPO_atlatl_2022-11-17_08-24-131oxp2put"]
Experiment3_labels =  ["20 workers, 2 CPU per, 8 CPU head","15 workers, 2 CPU per, 8 CPU head","10 workers, 2 CPU per, 8 CPU head","5 workers, 2 CPU per, 8 CPU head"]


Experiment7 = ["PPO_atlatl_2022-11-17_13-31-42seyiyjaw", "PPO_atlatl_2022-11-17_08-08-2601h1uuoe" ]
Experiment7_labels = ["Hexagly CNN GPU","Hexagly CNN"]

#function to read the csv file return contents as a list
def read_csv(file):
    with open(file, 'r') as f:
        reader = csv.reader(f)
        data = list(reader)
    return data


#function to plot the reward max from a the files in an expermeint
def plot_best_mean_max(file_list,experiemnt_name,labels):
    counter = 0
    fig,ax = plt.subplots(figsize=(10,10))

    for file in file_list:
        filename = root + "/" + file + "/progress.csv"
        data = read_csv(filename)
        
        pd = pandas.read_csv(filename)
        
        #from pd get values in episode_reward_max col
        pd_data = pd['episode_reward_max']
        
        #plot the reward_max_list vs the x list
        ax.plot(pd_data,label = labels[counter])
        counter += 1
    #label the axis x = iteration_number y = reward_max
    
    ax.set_ylabel('reward_max')
    ax.set_xlabel('iteration_number')
    
    #have y axis ticks every 100
    ax.yaxis.set_ticks(numpy.arange(0, 1000, 100))
    ax.xaxis.set_major_formatter('{x:9<5.1f}')
    ax.yaxis.set_major_formatter('{x:9<5.1f}')
    
    
    
    #show the legend
    ax.legend()
    plt.savefig("data_" +experiemnt_name + "_reward_max_list.png")
    
#function to plot the reward max from a the files in an expermeint
def plot_interation_time(file_list,experiemnt_name,labels):
    counter = 0
    fig,ax = plt.subplots(figsize=(10,10))
    #make the figure size bigger
    
    for file in file_list:
        filename = root + "/" + file + "/progress.csv"
        data = read_csv(filename)
        #get the time_this_iter_s column in the csv file
        
        pd = pandas.read_csv(filename)
        
        #from pd get values in time_this_iter_s col
        pd_data = pd['time_this_iter_s']
        
        #plot the reward_max_list vs the x list
        ax.plot(pd_data,label = labels[counter])
        counter += 1
    #label the axis x = iteration_number y = reward_max
    
    ax.set_ylabel('Iteration time')
    ax.set_xlabel('iteration_number')
    
    #have y axis ticks every 100
    ax.yaxis.set_ticks(numpy.arange(0, 300, 50))
    #show ticks every 10 iterations
    ax.xaxis.set_major_formatter('{x:9<5.1f}')
    ax.yaxis.set_major_formatter('{x:9<5.1f}')
    
    
    
    #show the legend
    ax.legend()
    plt.savefig("data_" +experiemnt_name + "iteration_time.png")
    
plot_best_mean_max(Experiment1,"Experiment1",Experiment1_labels)
plot_interation_time(Experiment1,"Experiment1",Experiment1_labels)

plot_best_mean_max(Experiment2,"Experiment2",Experiment2_labels)
plot_interation_time(Experiment2,"Experiment2",Experiment2_labels)

plot_best_mean_max(Experiment3,"Experiment3",Experiment3_labels)
plot_interation_time(Experiment3,"Experiment3",Experiment3_labels)

plot_best_mean_max(Experiment7,"Experiment7",Experiment7_labels)
plot_interation_time(Experiment7,"Experiment7",Experiment7_labels)


scores  = [ 278.90625, 216.83333333333331, 25.0, 50.0, 128.125, 181.2890625,
      75.0, 100.0, 95.83333333333333, 120.3125, 242.9375, 25.0, 25.0, 176.0, 118.75000000000001,
      93.75, 128.90625, 139.0625, 84.375, 102.34375, 115.625, 255.0234375, 25.0, 25.0,
      129.6875, 259.75, 128.125, 18.75, 71.875, 87.5, 162.5, 143.75, 12.5, 287.71875,
      85.9375, 25.0, 65.625, 44.666015625, 95.3125, 177.0, 183.49999999999997, 322.75,
      57.8125, 118.75000000000001, 118.75, 115.625, 25.0, 179.46875, 160.94921875000003,
      37.5, 131.25, 114.58333333333334, 185.41666666666669, 37.5, 25.0, 53.125, 81.25,
      275.7161458333333, 118.75000000000001, 215.66666666666666, 15.625, 116.92708333333334,
      184.375, 151.5625, 204.16666666666666, 129.16666666666669, 36.1328125, 192.83854166666669,
      25.0, 25.0, 137.5, 106.91861979166666, 173.00000000000003, 244.53125, 170.703125,
      66.66666666666667, 120.3125, 218.84765625, 25.0, 43.75, 77.0, 18.75, 65.625,
      47.91666666666667, 25.0, 217.71875, 299.4375, 39.0625, 62.65625, 314.0625, 64.58333333333333,
      93.75, 25.0, 171.14453125, 18.75, 125.0, 121.875, 197.34375, 18.75, 207.29166666666669,
      115.625, 112.50000000000001, 215.625, 175.99999999999997, 37.5, 136.70833333333334,
      12.5, 127.08333333333334, 118.75, 135.28645833333334, 18.75, 25.0, 25.0, 25.0,
      25.0, 67.375, 25.0, 25.0, 229.16666666666669, 68.75, 179.6875, 65.4375, 25.0,
      103.90625, 158.19091796875, 50.0, 329.2708333333333, 87.5, 59.37500000000001,
      0.0, 137.5, 162.50000000000003, 25.0, 132.140625, 84.375, 90.625, 115.625, 174.375,
      25.0, 71.875, 97.265625, 25.0, 43.75, 118.75, 41.66666666666667, 50.0, 179.16666666666669,
      218.75, 112.5, 172.46875, 18.75, 107.29166666666666, 98.03125, 138.671875, 132.8125,
      133.59375, 223.5, 6.25, 132.8125, 115.625, 279.70703125, 34.375, 157.8125, 115.625,
      25.0, 106.564453125, 242.31770833333334, 134.375, 25.0, 118.75, 201.171875,
      168.75, 31.25, 7.125, 178.125, 162.58333333333334, 146.875, 129.16666666666669,
      160.9375, 25.0, 25.0, 25.0, 198.6328125, 25.0, 118.75, 25.0, 25.0, 35.9375,
      125.0, 104.25, 16.666666666666668, 118.75000000000001, 182.29166666666669, 161.875,
      39.58333333333333, 104.16666666666667, 268.8333333333333, 90.625, 115.625, 179.78515625,
      242.1875, 25.0, 73.4375, 286.328125, 204.16666666666669, 15.625, 437.5, 25.0,
      25.0, 25.0, 35.25, 115.625, 40.625, 92.70833333333334, 25.0, 93.75, 227.08333333333334,
      31.25, 25.0, 87.5, 168.75, 20.833333333333332, 112.66666666666667, 253.45833333333334,
      126.04166666666667, 118.75000000000001, 18.75, 110.9375, 150.28125, 100.0, 101.0,
      25.0, 235.73958333333334, 40.625, 204.16666666666666, 25.0, 125.75, 112.5, 94.75,
      46.87499999999999, 420.01171875, 25.0, 115.625, 68.75, 95.83333333333333, 12.5,
      202.25, 146.875, 25.0, 17.583333333333332, 116.140625, 126.171875, 154.34773763020834,
      18.75, 100.0, 25.0, 75.78125, 98.0, 157.639892578125, 402.59375, 106.25, 206.75,
      199.98779296875, 173.95833333333331, 25.0, 164.2578125, 101.5625, 87.5, 211.51627604166666,
      25.0, 209.66796875, 212.625, 250.41666666666663, 84.375, 73.0, 126.66015625,
      25.0, 204.16666666666666, 160.234375, 20.3125, 62.5, 146.875, 25.0, 170.60546875,
      15.625, 120.3125, 73.109375, 89.0625, 54.6875, 72.78645833333333, 25.0, 164.0,
      115.625, 98.4375, 21.875, 96.875, 144.21875, 25.0, 109.375, 113.625, 39.0625,
      115.625, 68.9453125, 92.1875, 190.625, 194.53125, 508.89583333333337, 46.875,
      93.75, 68.75, 116.66666666666667, 201.75, 87.5, 71.875, 483.71875, 58.333333333333336,
      201.04166666666669, 59.375, 25.0, 82.8125, 188.91666666666666, 25.0, 25.0, 290.0,
      28.125, 439.59375, 240.625, 8.333333333333334, 12.5, 62.5, 60.875, 204.16666666666666,
      48.958333333333336, 128.90625, 144.01041666666669, 43.75, 175.0, 95.5078125,
      242.75, 128.125, 25.0, 108.33333333333334, 43.75, 68.40625, 116.66666666666667,
      106.25, 161.640625, 37.5, 87.5, 20.3125, 112.5, 91.66666666666667, 91.66666666666666,
      177.41666666666666, 90.625, 79.16666666666666, 83.33333333333333, 25.0, 82.5439453125,
      40.625, 270.96875, 120.3125, 37.5, 137.5, 25.0, 37.5, 279.74999999999994, 112.50000000000001,
      25.0, 25.0, 229.4700927734375, 135.5, 25.0, 25.0, 25.0, 96.31250000000001, 103.61328125,
      25.0, 179.19921875, 210.9375, 21.875, 76.171875, 262.88671875, 145.80078125,
      118.75000000000001, 162.41666666666669, 54.166666666666664, 89.0625, 56.25,
      115.625, 65.625, 43.75, 84.375, 25.0, 65.4375, 25.0, 115.625, 140.625, 108.59375,
      284.375, 66.40625, 31.25, 62.5, 209.85986328125, 115.625, 115.625, 25.0, 25.390625,
      25.0, 131.25, 184.375, 40.625, 138.54166666666666, 25.0, 50.0, 111.19791666666667,
      116.66666666666667, 35.416666666666664, 61.71875, 425.0625, 209.71875, 40.625,
      121.875, 62.890625, 68.75, 25.0, 115.625, 18.75, 25.0, 25.0, 145.83333333333334,
      159.375, 159.375, 146.0, 25.0, 125.00000000000001, 0.0, 159.375, 291.77734375,
      120.3125, 275.75, 119.3125, 188.328125, 43.75, 22.916666666666664, 309.375,
      122.91666666666667, 68.75, 107.75, 182.03173828125, 38.541666666666664, 6.25,
      98.267578125, 135.15625, 25.0, 80.20833333333333, 106.25, 135.41666666666669,
      82.8544921875, 115.625, 93.75, 159.375, 50.0, 169.53125, 219.82080078125, 70.3125,
      75.0, 100.0, 34.375, 139.0625, 73.4375, 252.83333333333334, 203.0625, 191.66666666666666,
      139.0625, 6.25, 158.5, 96.0, 54.6875, 79.16666666666666, 25.0, 15.625, 82.125,
      150.25000000000003, 143.75, 139.0625, 109.375, 67.1875, 225.0, 115.625, 77.08333333333333,
      174.04166666666666, 115.625, 37.5, 84.375, 12.5, 25.0, 193.06640625, 53.90625,
      34.375, 40.625, 101.5625, 25.0, 17.7734375, 106.25, 146.22981770833334, 35.9375,
      25.0, 156.25, 97.75, 227.8125, 75.0, 25.0, 154.6875, 27.083333333333336, 81.25,
      191.650390625, 25.0, 37.5, 192.375, 31.25, 62.5, 210.41666666666669, 212.49999999999997,
      132.8125, 165.966796875, 115.625, 119.625, 232.640625, 85.9375, 234.02083333333334,
      25.0, 66.75, 197.66666666666669, 247.31103515625, 31.25, 25.0, 120.67529296875,
      115.625, 225.0, 118.75, 25.0, 64.0625, 164.58333333333334, 25.0, 20.833333333333332,
      287.0625, 37.5, 29.6875, 186.1875, 109.375, 209.375, 144.79166666666666, 177.74999999999997,
      121.875, 138.54166666666669, 77.0, 142.44401041666666, 18.75, 162.5, 137.5,
      211.375, 170.70833333333334, 39.0625, 181.25, 32.8125, 53.125, 331.65869140625,
      110.015625, 115.625, 108.203125, 119.79166666666667, 129.16666666666669, 100.0,
      109.65625, 118.75000000000001, 25.0, 47.91666666666667, 74.21875, 115.625, 163.125,
      12.5, 72.79166666666667, 296.25, 114.58333333333334, 70.83333333333333, 79.6875,
      25.0, 125.0, 77.0, 62.5, 115.625, 115.625, 114.58333333333333, 29.6875, 118.75000000000001,
      112.50000000000001, 186.28125, 50.9765625, 81.25, 72.91666666666667, 100.0,
      25.0, 64.0625, 75.0, 25.0, 142.1875, 354.5833333333333, 115.625, 139.0625, 101.5625,
      25.0, 106.25, 225.0, 129.16666666666666, 325.65624999999994, 225.322265625,
      483.71875, 115.625, 96.875, 311.5, 78.125, 25.0, 93.75, 25.0, 151.8798828125,
      120.83333333333334, 62.890625, 92.96875, 62.890625, 217.70833333333334, 125.00000000000001,
      51.5625, 110.9375, 25.0, 171.875, 31.25, 64.0625, 209.875, 192.1875, 37.5, 15.625,
      247.91666666666666, 123.828125, 143.75, 161.45833333333334, 46.875, 63.359375,
      131.25, 93.75, 98.4375, 204.16666666666666, 257.8125, 95.03125, 146.875, 25.0,
      95.83333333333333, 18.75, 81.25, 43.75, 31.25, 62.59765625, 25.0, 25.0, 87.5,
      219.33333333333334, 25.0, 93.75, 146.58203125, 60.5, 140.625, 115.625, 6.25,
      12.5, 412.25, 35.7421875, 25.0, 149.8125, 13.020833333333334, 135.783203125,
      143.75, 6.25, 35.7421875, 21.875, 25.0, 81.23958333333333, 132.073974609375,
      143.75, 0.0, 31.4453125, 304.9583333333333, 86.9140625, 252.6875, 25.0, 27.083333333333336,
      18.75, 37.5, 76.125, 120.3125, 170.83333333333331, 375.70833333333337, 164.75,
      153.59375, 25.0, 40.625, 204.16666666666666, 195.3125, 122.0, 27.083333333333336,
      37.5, 87.5, 84.375, 148.69791666666669, 116.66666666666667, 25.0, 25.0, 8.333333333333334,
      87.5, 128.125, 25.0, 37.5, 87.5, 18.75, 37.5, 276.78125, 175.0, 242.759765625,
      37.5, 18.75, 76.5625, 62.5, 118.75, 145.83333333333334, 154.125, 114.0625, 25.0,
      190.58333333333334, 54.16666666666667, 283.158203125, 436.265625, 25.0, 118.75,
      246.00000000000003, 73.95833333333333, 25.0, 25.0, 62.5, 25.0, 140.125, 60.9375,
      25.0, 131.353759765625, 25.0, 151.30208333333331, 148.0, 34.375, 66.40625, 85.41666666666666,
      102.34375, 72.91666666666667, 350.25, 129.16666666666666, 138.54166666666666,
      185.9375, 150.0, 126.5625, 448.5625, 159.125, 82.8125, 151.04166666666666, 12.5,
      256.77083333333337, 87.5, 25.0, 118.75, 80.33854166666667, 81.25, 75.0, 133.33333333333334,
      315.96484375, 68.75, 37.0, 25.0, 87.5, 81.25, 112.50000000000001, 192.6259765625,
      28.125, 25.0, 120.3125, 40.625, 100.0, 147.55859375, 302.875, 115.625, 289.47526041666663,
      107.8125, 71.875, 25.0, 93.75000000000001, 18.75, 269.25, 250.12548828125, 46.875,
      15.625, 219.82080078125, 128.125, 37.5, 29.166666666666664, 25.0, 110.15625,
      104.296875, 71.875, 98.0, 12.5, 120.3125, 147.55859375, 50.0, 151.5625, 160.41666666666669,
      25.0, 107.03125, 25.0, 25.0, 46.875, 90.625, 131.25, 125.0, 114.76708984375,
      45.1171875, 15.625, 25.0, 276.515625, 40.625, 120.3125, 106.25, 12.5, 115.625,
      128.125, 25.0, 99.375, 106.25, 25.0, 100.0, 25.0, 25.0, 87.63020833333334, 225.77083333333334,
      142.1875, 62.5, 167.625, 204.16666666666666, 73.4375, 93.75, 204.16666666666666,
      230.28125, 25.0, 71.875, 96.875, 43.75, 150.0, 103.16666666666667, 25.0, 536.1263020833334,
      25.0, 15.625, 37.5, 179.16666666666666, 204.16666666666669, 134.375, 80.8828125,
      6.25, 148.97916666666669, 73.0, 25.0, 25.0, 4.0, 31.25, 15.625, 67.1875, 53.125,
      25.0, 26.041666666666664, 209.375, 117.05729166666667, 25.0, 12.5, 6.25, 399.69140625,
      28.125, 56.25, 128.125, 210.9375, 37.760416666666664, 81.89583333333334, 109.375,
      249.89583333333334, 98.95833333333334, 110.41666666666667, 204.16666666666666,
      115.625, 176.5625, 18.75, 91.66666666666666, 25.0, 25.0, 87.5, 103.125, 152.08333333333334,
      25.0, 95.3125, 96.875, 25.0, 16.666666666666668, 105.37109375, 42.8671875, 8.333333333333334,
      109.375, 228.484375, 15.625, 103.38541666666666, 154.6875, 204.16666666666669,
      192.421875, 215.75, 47.91666666666667, 31.25, 146.875, 168.75, 51.5625, 400.0221354166667,
      106.25, 25.0, 153.40625, 115.625, 247.31103515625, 106.25, 204.16666666666666,
      141.53645833333334, 46.875, 25.0, 25.0, 34.375, 419.29296875, 209.375, 398.109375,
      118.375, 150.00000000000003, 32.625, 25.0, 179.16666666666669, 54.6875, 33.7890625,
      131.1875, 85.41666666666667, 125.0, 51.041666666666664, 209.375, 25.0, 176.04166666666666,
      135.546875, 100.0, 106.25, 118.74999999999999, 220.3125, 145.27018229166666,
      175.09375, 25.0, 49.0, 91.40625, 75.8125, 117.9921875, 25.0, 21.875, 240.625,
      113.1103515625, 123.4375, 25.048828125, 295.31103515625, 6.25, 25.0, 234.328125,
      191.41666666666669, 131.25, 182.8125, 25.0, 103.125, 109.375, 25.0, 185.41666666666669,
      78.16666666666667, 65.625, 207.8125, 137.5, 60.9375, 115.625, 59.375, 101.5625,
      162.5, 18.75]
    
avg = np.average(scores)
print(avg)